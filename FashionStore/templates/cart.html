<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart | Trendy Fashion Hub</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<header>
  <h1>Trendy Fashion Hub</h1>
  <nav>
    <a href="{{ url_for('index') }}">Home</a>
    <a href="{{ url_for('index') }}#products">Shop</a>
    <a href="{{ url_for('view_cart') }}">Cart üõí</a>
  </nav>
</header>

<main class="cart-container">
  <h2>Your Shopping Cart</h2>

  {% if cart_items %}
  <div class="cart-table-wrapper">
    <table class="cart-table-style">
      <thead>
        <tr>
          <th>Item</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Subtotal</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_items %}
        <tr>
          <td class="cart-item-detail" data-label="Item">
            <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.item_name }}">
            <div class="cart-item-info">
                <span>{{ item.item_name }}</span>
            </div>
          </td>
          <td data-label="Unit Price">KSh {{ "{:,.2f}".format(item.unit_price) }}</td>
          <td data-label="Quantity">
            <form method="POST" action="{{ url_for('update_cart') }}" class="qty-form-edit">
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <div class="quantity-edit-control">
                  <input 
                      type="number" 
                      name="quantity" 
                      value="{{ item.quantity }}" 
                      min="1" 
                      max="{{ item.current_stock }}" 
                      class="qty-input-manual"
                      aria-label="Change quantity"
                  >
                  <button type="submit" name="action" value="manual_update" class="btn-edit-qty">Edit</button>
              </div>
            </form>
            {% if 0 < item.current_stock < 5 %}
              <small class="low-stock">Low stock!</small>
            {% endif %}
          </td>
          <td class="item-total" data-label="Subtotal">KSh {{ "{:,.2f}".format(item.total) }}</td>
          <td data-label="Remove">
            <form method="POST" action="{{ url_for('update_cart') }}">
              <input type="hidden" name="item_id" value="{{ item.id }}">
              <input type="hidden" name="quantity" value="0">
              <button type="submit" name="action" value="remove" class="remove-btn" aria-label="Remove item">‚úñ</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="cart-summary">
    <div><span>Subtotal:</span><span class="price-value">KSh {{ "{:,.2f}".format(grand_total) }}</span></div>
    <div><span>Shipping:</span><span class="price-value">KSh 0.00</span></div>
    <div class="grand-total"><span>Grand Total:</span><span class="price-value">KSh {{ "{:,.2f}".format(grand_total) }}</span></div>
    <form method="POST" action="{{ url_for('checkout') }}">
      <button type="submit" class="button checkout-btn">Proceed to Checkout</button>
    </form>
  </div>

  {% else %}
    <p class="empty-cart">Your cart is empty üõçÔ∏è</p>
    <p class="empty-cart-link"><a href="{{ url_for('index') }}">Back to Shop</a></p>
  {% endif %}
</main>

<footer>
  <p>&copy; 2025 Trendy Fashion Hub. All rights reserved.</p>
</footer>
</body>
</html>
